ChinaPayments.Component["admin-dashboard"]={container:{},configuration:{},data:{},_currentlyDisplayed:"",_resumeQuickSetup:!1,_skipQuickSetup:!1,_xhrSetPaymentMethodStatusMAP:{},Init:function(a){this.container=a;let t=this;china_payments_component_configuration_parse(this,(function(){ChinaPayments.Template.preload("admin-dashboard",["template/_navigation.html","template/_payment-gateways.html","template/_integrations.html","template/_optimizations.html"],(function(){t._loadData()}))}))},_loadData:function(){let a=this;ChinaPayments.setLoadingContent(this.container),ChinaPayments.API.fetch("china-payments/v1/administration/dashboard",!1,(function(t){"object"==typeof t?(a.data=t,a._loadTemplate()):ChinaPayments.setFailedAssetFetchContent(a.container)}))},_getTemplateArgs:function(){let a=this,t=china_payments_parse_args(this.data,this.configuration);return t.current_page=china_payments_hashtag_container_from_browser(this.container),"payment-gateways"!==t.current_page&&"integrations"!==t.current_page&&"optimizations"!==t.current_page&&(t.current_page="payment-gateways"),t.quick_setup_index=!1,t.quick_setup_return_index=!1,t.quick_setup_skip_index=!1,jQuery.each(t.quick_setup_steps,(function(e,n){if(n.is_completed&&!a._resumeQuickSetup)return!0;if(!1!==t.quick_setup_index){if(void 0===n.requires_steps)return t.quick_setup_skip_index=e,!1;if(a._resumeQuickSetup)return!0;let i=!0;return jQuery.each(n.requires_steps,(function(a,e){return!!t.quick_setup_steps[e].is_completed||(i=!1,!1)})),!i||(t.quick_setup_skip_index=e,!1)}t.quick_setup_index=e})),!1!==this._skipQuickSetup&&(t.quick_setup_return_index=t.quick_setup_index,t.quick_setup_index=this._skipQuickSetup,t.quick_setup_skip_index=!1),"integrations"===t.current_page&&!1===t.quick_setup_return_index&&!1===t.quick_setup_skip_index&&(t.quick_setup_return_index=0),!1===t.quick_setup_index||this.data.quick_setup_skipped||(t.current_page=t.quick_setup_steps[t.quick_setup_index].template,t.current_page!==china_payments_hashtag_container_from_browser(this.container)&&(this.container.attr("data-china-payments-hashtag-identifier",t.current_page),china_payments_hashtag_container_to_browser(this.container))),t},_loadTemplate:function(){let a=this,t=this._getTemplateArgs();this._currentlyDisplayed=t.current_page,this.container.attr("data-china-payments-hashtag-identifier",this._currentlyDisplayed),ChinaPayments.Template.load(this.container,"admin-dashboard","template/default.html",t,(function(){a._bindQuickSetupEvents(),a._bindTemplateEvents(),a._bindPaymentEvents();let t=china_payments_get_cookie("china_payments_dashboard_open_gateway");""!==t&&void 0!==t||(t="stripe"),"disabled"!==t&&a.container.find('[data-china-payments-has-payment-methods="1"][data-china-payments-gateway-alias="'+t+'"] > [data-china-payments-component-admin-dashboard-section="header"] > h2').trigger("click")}))},_bindQuickSetupEvents:function(){let a=this;this.container.find('[data-china-payments-component-admin-dashboard-trigger="quick-setup"]').on("click",(function(){ChinaPayments.setLoadingContent(jQuery(this),"","mini"),a.data.quick_setup_skipped=0,a._resumeQuickSetup=!0,a._loadTemplate()})),this.container.find('[data-china-payments-component-admin-dashboard-trigger="quick-setup-exit"]').on("click",(function(){ChinaPayments.setLoadingContent(jQuery(this),"","mini"),a.data.quick_setup_skipped=1,ChinaPayments.API.post("china-payments/v1/administration/set-quick-setup-skip",{status:1},(function(t){a.data=t,a._loadTemplate()}))})),this.container.find('[data-china-payments-component-admin-dashboard-trigger^="quick_setup_skip_"]').on("click",(function(){ChinaPayments.setLoadingContent(jQuery(this),"","mini"),a._skipQuickSetup=parseInt(jQuery(this).attr("data-china-payments-component-admin-dashboard-trigger").replace("quick_setup_skip_","")),a._loadTemplate()})),this.container.find('[data-china-payments-component-admin-dashboard-trigger="quick_setup_return"]').on("click",(function(){ChinaPayments.setLoadingContent(jQuery(this),"","mini"),a._skipQuickSetup=!1,a._loadTemplate()}))},_bindTemplateEvents:function(){let a=this;this.container.find('[data-china-payments-component-admin-dashboard-trigger^="install_plugin_"]').on("click",(function(){if(void 0!==jQuery(this).attr("disabled"))return;if(jQuery(this).find(".china-payments-application-loader-wrapper").length>0)return;ChinaPayments.setLoadingContent(jQuery(this),"","mini");let t=jQuery(this).parents('[data-china-payments-component-admin-dashboard-section="integration_information"]:first');t.find("[data-china-payments-notification]").remove();let e=jQuery(this).attr("data-china-payments-component-admin-dashboard-trigger").replace("install_plugin_","");ChinaPayments.API.post("china-payments/v1/plugin/install",{identifier:e},(function(n){void 0===n.message?ChinaPayments.API.post("china-payments/v1/plugin/activate",{identifier:e},(function(t){a._loadData()})):t.append('<div data-china-payments-notification="danger">'+n.message+"</div>")}))})),this.container.find('[data-china-payments-component-admin-dashboard-trigger^="activate_plugin_"]').on("click",(function(){if(void 0!==jQuery(this).attr("disabled"))return;if(jQuery(this).find(".china-payments-application-loader-wrapper").length>0)return;let t=jQuery(this).parents('[data-china-payments-component-admin-dashboard-section="integration_information"]:first');t.find("[data-china-payments-notification]").remove(),ChinaPayments.setLoadingContent(jQuery(this),"","mini");let e=jQuery(this).attr("data-china-payments-component-admin-dashboard-trigger").replace("activate_plugin_","");ChinaPayments.API.post("china-payments/v1/plugin/activate",{identifier:e},(function(e){void 0===e.message?a._loadData():t.append('<div data-china-payments-notification="danger">'+e.message+"</div>")}))}))},_bindPaymentEvents:function(){let a=this;this.container.find('[data-china-payments-has-payment-methods="1"] > [data-china-payments-component-admin-dashboard-section="header"] > h2').on("click",(function(){let a=jQuery(this).parents("[data-china-payments-has-payment-methods]"),t=a.find('[data-china-payments-component-admin-dashboard-section="payment_methods_container"]');parseInt(a.attr("data-china-payments-has-payment-methods-visible"))?(a.attr("data-china-payments-has-payment-methods-visible",0),t.slideUp("slow"),china_payments_set_cookie("china_payments_dashboard_open_gateway","disabled",43200)):(a.attr("data-china-payments-has-payment-methods-visible",1),t.slideDown("slow"),china_payments_set_cookie("china_payments_dashboard_open_gateway",a.attr("data-china-payments-gateway-alias"),43200))})),this.container.find('[data-china-payments-component-admin-dashboard-trigger="gateway_mode_checkbox"]').on("change",(function(){let t=jQuery(this).is(":checked")?"test":"live";jQuery(this).parents("[data-china-payments-gateway-mode]").attr("data-china-payments-gateway-mode",t),a.data.payment_gateway.stripe.mode=t,ChinaPayments.API.post("china-payments/v1/payment-gateway/set-mode",{payment_gateway:jQuery(this).parents("[data-china-payments-gateway-alias]:first").attr("data-china-payments-gateway-alias"),is_live:jQuery(this).is(":checked")?0:1},(function(a){}))})),this.container.find('[data-china-payments-component-admin-dashboard-trigger^="payment_method_"]').on("change",(function(){let t=jQuery(this).parents("[data-china-payments-gateway-alias]:first").attr("data-china-payments-gateway-alias"),e=jQuery(this).attr("data-china-payments-component-admin-dashboard-trigger").replace("payment_method_",""),n=jQuery(this).parents("td:first");jQuery(this).is(":checked")?a.data.payment_gateway[t].payment_methods_enabled.push(e):a.data.payment_gateway[t].payment_methods_enabled=a.data.payment_gateway.stripe.payment_methods_enabled.filter((function(a,t,n){return a!==e})),n.find(" > label").hide(),n.append(china_payments_element_loader("mini")),void 0!==a._xhrSetPaymentMethodStatusMAP[t]&&!1!==a._xhrSetPaymentMethodStatusMAP[t]&&a._xhrSetPaymentMethodStatusMAP[t].abort(),a._xhrSetPaymentMethodStatusMAP[t]=ChinaPayments.API.post("china-payments/v1/payment-gateway/set-payment-methods",{payment_gateway:t,payment_methods:a.data.payment_gateway[t].payment_methods_enabled},(function(e){"object"==typeof e&&"ok"===e.status&&(void 0!==e.refresh&&parseInt(e.refresh)&&a._loadData(),a._xhrSetPaymentMethodStatusMAP[t]=!1,a.container.find('[data-china-payments-component-admin-dashboard-trigger^="payment_method_"]').each((function(){let a=jQuery(this).parents("td:first");a.find(" > label").is(":hidden")&&(a.find(".china-payments-application-loader-wrapper").remove(),a.find(" > label").show())})))}))})),this.container.find('[data-china-payments-component-admin-dashboard-trigger^="gateway_connect_"],[data-china-payments-component-admin-dashboard-trigger^="gateway_settings_"]').on("click",(function(){if(jQuery(this).find(".china-payments-application-loader-wrapper").length>0)return;if(parseInt(ChinaPayments.settings.is_https)&&-1===window.location.href.indexOf(ChinaPayments.settings.site_url))return void ChinaPayments.Library.Popup.display('<div data-china-payments-notification="danger">'+a.data.lang.notification_url_mismatch_ssl.replace("%s",jQuery(this).parents("[data-china-payments-gateway-alias]:first").find('> [data-china-payments-component-admin-dashboard-section="header"]:first > h2').text())+"</div>");let t=[];if(jQuery.each(a.data.invalid_url_characters,(function(a,e){-1!==ChinaPayments.settings.site_url.indexOf(e)&&t.push(e)})),t.length>0)return void ChinaPayments.Library.Popup.display('<div data-china-payments-notification="danger">'+a.data.lang.notification_url_invalid_characters.replace("%s","<strong>"+t.join(" ")+"</strong>").replace("%s",jQuery(this).parents("[data-china-payments-gateway-alias]:first").find('> [data-china-payments-component-admin-dashboard-section="header"]:first > h2').text())+"</div>");let e=jQuery(this),n=jQuery(this).parents("[data-china-payments-gateway-alias]:first"),i="live"===jQuery(this).attr("data-china-payments-component-admin-dashboard-trigger").replace("gateway_connect_","").replace("gateway_settings_","")?1:0,s=n.attr("data-china-payments-gateway-alias"),r=jQuery(this).html();ChinaPayments.setLoadingContent(jQuery(this),"","mini"),ChinaPayments.API.fetch("china-payments/v1/payment-gateway/connect",{payment_gateway:s,is_live:i},(function(t){if("redirect"!==t.type){if("settings"===t.type){let o=n.find(' > [data-china-payments-component-admin-dashboard-section="header"] > h2 ').text()+' <span data-china-payments-mode="'+(i?"live":"test")+'">'+(i?a.data.lang.payment_gateway_mode_live:a.data.lang.payment_gateway_mode_test)+"</span>";o=a.data.lang.payment_gateway_settings_title.replace("%s",o),e.html(r),ChinaPayments.Library.Popup.display('<div data-china-payments-component="admin-form" data-china-payments-component-args="'+_.escape(JSON.stringify({title:o,description:t.description,fields:t.fields,operations:t.operations,rest_data:{payment_gateway:s,is_live:i},rest_path:"china-payments/v1/payment-gateway/save-settings"}))+'"></div>',{trigger_app_init:!0}),ChinaPayments.Library.Popup.getContainerObject().find('[data-china-payments-component="admin-form"]').on("china_payments_settings_saved",(function(){ChinaPayments.Library.Popup.close(),a._loadData()}))}}else window.location=t.url}))})),this.container.find('[data-china-payments-component-admin-dashboard-trigger^="gateway_disconnect_"]').on("click",(function(){ChinaPayments.setLoadingContent(jQuery(this),"","mini"),ChinaPayments.API.post("china-payments/v1/payment-gateway/disconnect",{payment_gateway:jQuery(this).parents("[data-china-payments-gateway-alias]:first").attr("data-china-payments-gateway-alias"),is_live:"live"===jQuery(this).attr("data-china-payments-component-admin-dashboard-trigger").replace("gateway_disconnect_","")?1:0},(function(t){a._loadData()}))})),this.container.find('[data-china-payments-component-admin-dashboard-trigger^="payment_gateway_webhook_settings_"]').on("click",(function(){let t=jQuery(this),e=jQuery(this).parents("[data-china-payments-gateway-alias]:first").attr("data-china-payments-gateway-alias"),n=JSON.parse(t.attr("data-china-payments-component-admin-dashboard-args")),i="live"===t.attr("data-china-payments-component-admin-dashboard-trigger").replace("payment_gateway_webhook_settings_","").substr(0,4)?1:0;ChinaPayments.Library.Popup.display('<div data-china-payments-component="admin-form" data-china-payments-component-args="'+_.escape(JSON.stringify({title:n.title,description:n.description,fields:n.fields,operations:{save:{label:a.data.lang.payment_gateway_webhook_settings_save,type:"save",order:1}},rest_data:{payment_gateway:e,is_live:i},rest_path:"china-payments/v1/payment-gateway/save-webhook-settings"}))+'"></div>',{trigger_app_init:!0}),ChinaPayments.Library.Popup.getContainerObject().find('[data-china-payments-component="admin-form"]').on("china_payments_settings_saved",(function(){ChinaPayments.Library.Popup.close(),a._loadData()}))}))},__onWindowHashChange:function(a){0===parseInt(this.data.quick_setup_skipped)&&ChinaPayments.API.post("china-payments/v1/administration/set-quick-setup-skip",{status:1},(function(a){})),a!==this._currentlyDisplayed&&this._loadTemplate()}};